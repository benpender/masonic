{"version":3,"file":"index.dev.mjs","sources":["../../src/use-scroller.ts","../../src/elements-cache.ts","../../src/use-force-update.ts","../../src/use-masonry.tsx","../../src/masonry-scroller.tsx","../../src/use-container-position.ts","../../src/use-resize-observer.ts","../../src/interval-tree.ts","../../src/use-positioner.ts","../../src/use-scroll-to-index.ts","../../src/masonry.tsx","../../src/list.tsx","../../src/use-infinite-loader.ts"],"sourcesContent":["import * as React from 'react'\nimport useScrollPosition from '@react-hook/window-scroll'\nimport {requestTimeout, clearRequestTimeout} from '@essentials/request-timeout'\n\n/**\n * A hook for tracking whether the `window` is currently being scrolled and it's scroll position on\n * the y-axis. These values are used for determining which grid cells to render and when\n * to add styles to the masonry container that maximize scroll performance.\n *\n * @param offset The vertical space in pixels between the top of the grid container and the top\n *  of the browser `document.documentElement`.\n * @param fps This determines how often (in frames per second) to update the scroll position of the\n *  browser `window` in state, and as a result the rate the masonry grid recalculates its visible cells.\n *  The default value of `12` has been very reasonable in my own testing, but if you have particularly\n *  heavy `render` components it may be prudent to reduce this number.\n */\nexport function useScroller(\n  offset = 0,\n  fps = 12\n): {scrollTop: number; isScrolling: boolean} {\n  const scrollTop = useScrollPosition(fps)\n  const [isScrolling, setIsScrolling] = React.useState(false)\n  const didMount = React.useRef(0)\n\n  React.useEffect(() => {\n    if (didMount.current === 1) setIsScrolling(true)\n    const to = requestTimeout(() => {\n      // This is here to prevent premature bail outs while maintaining high resolution\n      // unsets. Without it there will always bee a lot of unnecessary DOM writes to style.\n      setIsScrolling(false)\n    }, 40 + 1000 / fps)\n    didMount.current = 1\n    return () => clearRequestTimeout(to)\n  }, [fps, scrollTop])\n\n  return {scrollTop: Math.max(0, scrollTop - offset), isScrolling}\n}\n","export const elementsCache: WeakMap<Element, number> = new WeakMap()\n","import * as React from 'react'\n\nexport function useForceUpdate() {\n  const setState = React.useState(emptyObj)[1]\n  return React.useRef(() => setState({})).current\n}\n\nconst emptyObj = {}\n","import * as React from 'react'\nimport trieMemoize from 'trie-memoize'\nimport OneKeyMap from '@essentials/one-key-map'\nimport memoizeOne from '@essentials/memoize-one'\nimport useLatest from '@react-hook/latest'\nimport {elementsCache} from './elements-cache'\nimport {useForceUpdate} from './use-force-update'\nimport type {Positioner} from './use-positioner'\n\n/**\n * This hook handles the render phases of the masonry layout and returns the grid as a React element.\n *\n * @param options Options for configuring the masonry layout renderer. See `UseMasonryOptions`.\n */\nexport function useMasonry<Item>({\n  // Measurement and layout\n  positioner,\n  resizeObserver,\n  // Grid items\n  items,\n  // Container props\n  as: ContainerComponent = 'div',\n  id,\n  className,\n  style,\n  role = 'grid',\n  tabIndex = 0,\n  containerRef,\n  // Item props\n  itemAs: ItemComponent = 'div',\n  itemStyle,\n  itemHeightEstimate = 300,\n  itemKey = defaultGetItemKey,\n  // Rendering props\n  overscanBy = 2,\n  scrollTop,\n  isScrolling,\n  height,\n  render: RenderComponent,\n  onRender,\n}: UseMasonryOptions<Item>) {\n  let startIndex = 0\n  let stopIndex: number | undefined\n  const forceUpdate = useForceUpdate()\n  const setItemRef = getRefSetter(positioner, resizeObserver)\n  const itemCount = items.length\n  const {\n    columnWidth,\n    columnCount,\n    range,\n    estimateHeight,\n    size,\n    shortestColumn,\n  } = positioner\n  const measuredCount = size()\n  const shortestColumnSize = shortestColumn()\n  const children: React.ReactElement[] = []\n  const itemRole = role\n  const storedOnRender = useLatest(onRender)\n\n  overscanBy = height * overscanBy\n  const rangeEnd = scrollTop + overscanBy\n  const needsFreshBatch =\n    shortestColumnSize < rangeEnd && measuredCount < itemCount\n\n  range(\n    // We overscan in both directions because users scroll both ways,\n    // though one must admit scrolling down is more common and thus\n    // we only overscan by half the downward overscan amount\n    Math.max(0, scrollTop - overscanBy / 2),\n    rangeEnd,\n    (index, left, top) => {\n      const data = items[index]\n      const key = itemKey(data, index)\n      const phaseTwoStyle: React.CSSProperties = {\n        top,\n        left,\n        width: columnWidth,\n        writingMode: 'horizontal-tb',\n        position: 'absolute',\n      }\n\n      /* istanbul ignore next */\n      if (\n        typeof process !== 'undefined' &&\n        process.env.NODE_ENV !== 'production'\n      ) {\n        throwWithoutData(data, index)\n      }\n\n      children.push(\n        <ItemComponent\n          key={key}\n          ref={setItemRef(index)}\n          role={itemRole}\n          tabIndex={index}\n          style={\n            typeof itemStyle === 'object' && itemStyle !== null\n              ? Object.assign({}, phaseTwoStyle, itemStyle)\n              : phaseTwoStyle\n          }\n        >\n          {createRenderElement(RenderComponent, index, data, columnWidth)}\n        </ItemComponent>\n      )\n\n      if (stopIndex === void 0) {\n        startIndex = index\n        stopIndex = index\n      } else {\n        startIndex = Math.min(startIndex, index)\n        stopIndex = Math.max(stopIndex, index)\n      }\n    }\n  )\n\n  if (needsFreshBatch) {\n    const batchSize = Math.min(\n      itemCount - measuredCount,\n      Math.ceil(\n        ((scrollTop + overscanBy - shortestColumnSize) / itemHeightEstimate) *\n          columnCount\n      )\n    )\n\n    let index = measuredCount\n    const phaseOneStyle = getCachedSize(columnWidth)\n\n    for (; index < measuredCount + batchSize; index++) {\n      const data = items[index]\n      const key = itemKey(data, index)\n\n      /* istanbul ignore next */\n      if (\n        typeof process !== 'undefined' &&\n        process.env.NODE_ENV !== 'production'\n      ) {\n        throwWithoutData(data, index)\n      }\n\n      children.push(\n        <ItemComponent\n          key={key}\n          ref={setItemRef(index)}\n          role={itemRole}\n          style={\n            typeof itemStyle === 'object'\n              ? Object.assign({}, phaseOneStyle, itemStyle)\n              : phaseOneStyle\n          }\n        >\n          {createRenderElement(RenderComponent, index, data, columnWidth)}\n        </ItemComponent>\n      )\n    }\n  }\n\n  // Calls the onRender callback if the rendered indices changed\n  React.useEffect(() => {\n    if (typeof storedOnRender.current === 'function' && stopIndex !== void 0)\n      storedOnRender.current(startIndex, stopIndex, items)\n\n    didEverMount = '1'\n  }, [startIndex, stopIndex, items, storedOnRender])\n  // If we needed a fresh batch we should reload our components with the measured\n  // sizes\n  React.useEffect(() => {\n    if (needsFreshBatch) forceUpdate()\n    // eslint-disable-next-line\n  }, [needsFreshBatch])\n\n  // gets the container style object based upon the estimated height and whether or not\n  // the page is being scrolled\n  const containerStyle = getContainerStyle(\n    isScrolling,\n    estimateHeight(itemCount, itemHeightEstimate)\n  )\n\n  return (\n    <ContainerComponent\n      ref={containerRef}\n      key={didEverMount}\n      id={id}\n      role={role}\n      className={className}\n      tabIndex={tabIndex}\n      style={\n        typeof style === 'object'\n          ? assignUserStyle(containerStyle, style)\n          : containerStyle\n      }\n      children={children}\n    />\n  )\n}\n\n/* istanbul ignore next */\nfunction throwWithoutData(data: any, index: number) {\n  if (!data) {\n    throw new Error(\n      `No data was found at index: ${index}\\n\\n` +\n        `This usually happens when you've mutated or changed the \"items\" array in a ` +\n        `way that makes it shorter than the previous \"items\" array. Masonic knows nothing ` +\n        `about your underlying data and when it caches cell positions, it assumes you aren't ` +\n        `mutating the underlying \"items\".\\n\\n` +\n        `See https://codesandbox.io/s/masonic-w-react-router-example-2b5f9?file=/src/index.js for ` +\n        `an example that gets around this limitations. For advanced implementations, see ` +\n        `https://codesandbox.io/s/masonic-w-react-router-and-advanced-config-example-8em42?file=/src/index.js\\n\\n` +\n        `If this was the result of your removing an item from your \"items\", see this issue: ` +\n        `https://github.com/jaredLunde/masonic/issues/12`\n    )\n  }\n}\n\n// This is for triggering a remount after SSR has loaded in the client w/ hydrate()\nlet didEverMount = '0'\n\nexport interface UseMasonryOptions<Item> {\n  /**\n   * An array containing the data used by the grid items.\n   */\n  items: Item[]\n  /**\n   * A grid cell positioner and cache created by the `usePositioner()` hook or\n   * the `createPositioner` utility.\n   */\n  positioner: Positioner\n  /**\n   * A resize observer that tracks mutations to the grid cells and forces the\n   * Masonry grid to recalculate its layout if any cells affect column heights\n   * change. Check out the `useResizeObserver()` hook.\n   */\n  resizeObserver?: {\n    observe: ResizeObserver['observe']\n    disconnect: ResizeObserver['observe']\n    unobserve: ResizeObserver['unobserve']\n  }\n  /**\n   * This is the type of element the grid container will be rendered as.\n   * @default \"div\"`\n   */\n  as?: keyof JSX.IntrinsicElements | React.ComponentType<any>\n  /**\n   * Optionally gives the grid container an `id` prop.\n   */\n  id?: string\n  /**\n   * Optionally gives the grid container a `className` prop.\n   */\n  className?: string\n  /**\n   * Adds extra `style` attributes to the container in addition to those\n   * created by the `useMasonry()` hook.\n   */\n  style?: React.CSSProperties\n  /**\n   * Optionally swap out the accessibility `role` prop of the container and its items.\n   * @default \"grid\"\n   */\n  role?: 'grid' | 'list'\n  /**\n   * Change the `tabIndex` of the grid container.\n   * @default 0\n   */\n  tabIndex?: number\n  /**\n   * Forwards a React ref to the grid container.\n   */\n  containerRef?:\n    | ((element: HTMLElement) => void)\n    | React.MutableRefObject<HTMLElement | null>\n  /**\n   * This is the type of element the grid items will be rendered as.\n   * @default \"div\"\n   */\n  itemAs?: keyof JSX.IntrinsicElements | React.ComponentType<any>\n  /**\n   * Adds extra `style` attributes to the grid items in addition to those\n   * created by the `useMasonry()` hook.\n   */\n  itemStyle?: React.CSSProperties\n  /**\n   * This value is used for estimating the initial height of the masonry grid. It is important for\n   * the UX of the scrolling behavior and in determining how many `items` to render in a batch, so it's\n   * wise to set this value with some level accuracy, though it doesn't need to be perfect.\n   * @default 300\n   */\n  itemHeightEstimate?: number\n  /**\n   * The value returned here must be unique to the item. By default, the key is the item's index. This is ok\n   * if your collection of items is never modified. Setting this property ensures that the component in `render`\n   * is reused each time the masonry grid is reflowed. A common pattern would be to return the item's database\n   * ID here if there is one, e.g. `data => data.id`\n   * @default (data, index) => index`\n   */\n  itemKey?: (data: Item, index: number) => string | number\n  /**\n   * This number is used for determining the number of grid cells outside of the visible window to render.\n   * The default value is `2` which means \"render 2 windows worth (2 * `height`) of content before and after\n   * the items in the visible window\". A value of `3` would be 3 windows worth of grid cells, so it's a\n   * linear relationship.\n   *\n   * Overscanning is important for preventing tearing when scrolling through items in the grid, but setting\n   * too high of a vaimport { useForceUpdate } from './use-force-update';\nlue may create too much work for React to handle, so it's best that you tune this\n   * value accordingly.\n   * @default 2\n   */\n  overscanBy?: number\n\n  /**\n   * This is the height of the window. If you're rendering the grid relative to the browser `window`,\n   * the current `document.documentElement.clientHeight` is the value you'll want to set here. If you're\n   * rendering the grid inside of another HTML element, you'll want to provide the current `element.offsetHeight`\n   * here.\n   */\n  height: number\n  /**\n   * The current scroll progress in pixel of the window the grid is rendered in. If you're rendering\n   * the grid relative to the browser `window`, you'll want the most current `window.scrollY` here.\n   * If you're rendering the grid inside of another HTML element, you'll want the current `element.scrollTop`\n   * value here. The `useScroller()` hook and `<MasonryScroller>` components will help you if you're\n   * rendering the grid relative to the browser `window`.\n   */\n  scrollTop: number\n  /**\n   * This property is used for determining whether or not the grid container should add styles that\n   * dramatically increase scroll performance. That is, turning off `pointer-events` and adding a\n   * `will-change: contents;` value to the style string. You can forgo using this prop, but I would\n   * not recommend that. The `useScroller()` hook and `<MasonryScroller>` components will help you if\n   * you're rendering the grid relative to the browser `window`.\n   * @default false\n   */\n  isScrolling?: boolean\n  /**\n   * This component is rendered for each item of your `items` prop array. It should accept three props:\n   * `index`, `width`, and `data`. See RenderComponentProps.\n   */\n  render: React.ComponentType<RenderComponentProps<Item>>\n  /**\n   * This callback is invoked any time the items currently being rendered by the grid change.\n   */\n  onRender?: (startIndex: number, stopIndex: number, items: Item[]) => void\n}\n\nexport interface RenderComponentProps<Item> {\n  /**\n   * The index of the cell in the `items` prop array.\n   */\n  index: number\n  /**\n   * The rendered width of the cell's column.\n   */\n  width: number\n  /**\n   * The data at `items[index]` of your `items` prop array.\n   */\n  data: Item\n}\n\n//\n// Render-phase utilities\n\n// ~5.5x faster than createElement without the memo\nconst createRenderElement = trieMemoize(\n  [OneKeyMap, {}, WeakMap, OneKeyMap],\n  (RenderComponent, index, data, columnWidth) => (\n    <RenderComponent index={index} data={data} width={columnWidth} />\n  )\n)\n\nconst getContainerStyle = memoizeOne(\n  (isScrolling: boolean | undefined, estimateHeight: number) => ({\n    position: 'relative',\n    width: '100%',\n    maxWidth: '100%',\n    height: Math.ceil(estimateHeight),\n    maxHeight: Math.ceil(estimateHeight),\n    willChange: isScrolling ? 'contents' : void 0,\n    pointerEvents: isScrolling ? 'none' : void 0,\n  })\n)\n\nconst cmp2 = (args: IArguments, pargs: IArguments | any[]): boolean =>\n  args[0] === pargs[0] && args[1] === pargs[1]\n\nconst assignUserStyle = memoizeOne(\n  (containerStyle, userStyle) => Object.assign({}, containerStyle, userStyle),\n  // @ts-ignore\n  cmp2\n)\n\nfunction defaultGetItemKey<Item>(_: Item, i: number) {\n  return i\n}\n\n// the below memoizations for for ensuring shallow equal is reliable for pure\n// component children\nconst getCachedSize = memoizeOne(\n  (width: number): React.CSSProperties => ({\n    width,\n    zIndex: -1000,\n    visibility: 'hidden',\n    position: 'absolute',\n    writingMode: 'horizontal-tb',\n  }),\n  (args, pargs) => args[0] === pargs[0]\n)\n\nconst getRefSetter = memoizeOne(\n  (\n    positioner: Positioner,\n    resizeObserver?: UseMasonryOptions<any>['resizeObserver']\n  ) => (index: number) => (el: HTMLElement | null): void => {\n    if (el === null) return\n    if (resizeObserver) {\n      resizeObserver.observe(el)\n      elementsCache.set(el, index)\n    }\n    if (positioner.get(index) === void 0) positioner.set(index, el.offsetHeight)\n  },\n  // @ts-ignore\n  cmp2\n)\n","import {useScroller} from './use-scroller'\nimport {useMasonry} from './use-masonry'\nimport type {UseMasonryOptions} from './use-masonry'\n/**\n * A heavily-optimized component that updates `useMasonry()` when the scroll position of the browser `window`\n * changes. This bare-metal component is used by `<Masonry>` under the hood.\n */\nexport function MasonryScroller<Item>(props: MasonryScrollerProps<Item>) {\n  // We put this in its own layer because it's the thing that will trigger the most updates\n  // and we don't want to slower ourselves by cycling through all the functions, objects, and effects\n  // of other hooks\n  const {scrollTop, isScrolling} = useScroller(props.offset, props.scrollFps)\n  // This is an update-heavy phase and while we could just Object.assign here,\n  // it is way faster to inline and there's a relatively low hit to he bundle\n  // size.\n  return useMasonry<Item>({\n    scrollTop,\n    isScrolling,\n    positioner: props.positioner,\n    resizeObserver: props.resizeObserver,\n    items: props.items,\n    onRender: props.onRender,\n    as: props.as,\n    id: props.id,\n    className: props.className,\n    style: props.style,\n    role: props.role,\n    tabIndex: props.tabIndex,\n    containerRef: props.containerRef,\n    itemAs: props.itemAs,\n    itemStyle: props.itemStyle,\n    itemHeightEstimate: props.itemHeightEstimate,\n    itemKey: props.itemKey,\n    overscanBy: props.overscanBy,\n    height: props.height,\n    render: props.render,\n  })\n}\n\nexport interface MasonryScrollerProps<Item>\n  extends Omit<UseMasonryOptions<Item>, 'scrollTop' | 'isScrolling'> {\n  /**\n   * This determines how often (in frames per second) to update the scroll position of the\n   * browser `window` in state, and as a result the rate the masonry grid recalculates its visible cells.\n   * The default value of `12` has been very reasonable in my own testing, but if you have particularly\n   * heavy `render` components it may be prudent to reduce this number.\n   * @default 12\n   */\n  scrollFps?: number\n  /**\n   * The vertical space in pixels between the top of the grid container and the top\n   * of the browser `document.documentElement`.\n   * @default 0\n   */\n  offset?: number\n}\n\nif (typeof process !== 'undefined' && process.env.NODE_ENV !== 'production') {\n  MasonryScroller.displayName = 'MasonryScroller'\n}\n","import * as React from 'react'\nimport useLayoutEffect from '@react-hook/passive-layout-effect'\n\n/**\n * A hook for measuring the width of the grid container, as well as its distance\n * from the top of the document. These values are necessary to correctly calculate the number/width\n * of columns to render, as well as the number of rows to render.\n *\n * @param elementRef A `ref` object created by `React.useRef()`. That ref should be provided to the\n *   `containerRef` property in `useMasonry()`.\n * @param deps You can force this hook to recalculate the `offset` and `width` whenever this\n *   dependencies list changes. A common dependencies list might look like `[windowWidth, windowHeight]`,\n *   which would force the hook to recalculate any time the size of the browser `window` changed.\n */\nexport function useContainerPosition(\n  elementRef: React.MutableRefObject<HTMLElement | null>,\n  deps: React.DependencyList = emptyArr\n): ContainerPosition {\n  const [containerPosition, setContainerPosition] = React.useState<\n    ContainerPosition\n  >({offset: 0, width: 0})\n\n  useLayoutEffect(() => {\n    const {current} = elementRef\n    if (current !== null) {\n      let offset = 0\n      let el = current\n\n      do {\n        offset += el.offsetTop || 0\n        el = el.offsetParent as HTMLElement\n      } while (el)\n\n      if (\n        offset !== containerPosition.offset ||\n        current.offsetWidth !== containerPosition.width\n      ) {\n        setContainerPosition({\n          offset,\n          width: current.offsetWidth,\n        })\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, deps)\n\n  return containerPosition\n}\n\nexport interface ContainerPosition {\n  /**\n   * The distance in pixels between the top of the element in `elementRef` and the top of\n   * the `document.documentElement`.\n   */\n  offset: number\n  /**\n   * The `offsetWidth` of the element in `elementRef`.\n   */\n  width: number\n}\n\nconst emptyArr: [] = []\n","import * as React from 'react'\nimport trieMemoize from 'trie-memoize'\nimport ResizeObserver from 'resize-observer-polyfill'\nimport rafSchd from 'raf-schd'\nimport {elementsCache} from './elements-cache'\nimport {useForceUpdate} from './use-force-update'\nimport type {Positioner} from './use-positioner'\n\n/**\n * Creates a resize observer that forces updates to the grid cell positions when mutations are\n * made to cells affecting their height.\n *\n * @param positioner The masonry cell positioner created by the `usePositioner()` hook.\n */\nexport function useResizeObserver(positioner: Positioner) {\n  const forceUpdate = useForceUpdate()\n  const resizeObserver = createResizeObserver(positioner, forceUpdate)\n  // Cleans up the resize observers when they change or the\n  // component unmounts\n  React.useEffect(() => () => resizeObserver.disconnect(), [resizeObserver])\n  return resizeObserver\n}\n\n/**\n * Creates a resize observer that fires an `updater` callback whenever the height of\n * one or many cells change. The `useResizeObserver()` hook is using this under the hood.\n *\n * @param positioner A cell positioner created by the `usePositioner()` hook or the `createPositioner()` utility\n * @param updater A callback that fires whenever one or many cell heights change.\n */\nexport const createResizeObserver = trieMemoize(\n  [WeakMap],\n  // TODO: figure out a way to test this\n  /* istanbul ignore next */\n  (positioner: Positioner, updater: (updates: number[]) => void) => {\n    const handleEntries = rafSchd(((entries) => {\n      const updates: number[] = []\n      let i = 0\n\n      for (; i < entries.length; i++) {\n        const entry = entries[i]\n        const height = (entry.target as HTMLElement).offsetHeight\n\n        if (height > 0) {\n          const index = elementsCache.get(entry.target)\n\n          if (index !== void 0) {\n            const position = positioner.get(index)\n\n            if (position !== void 0 && height !== position.height)\n              updates.push(index, height)\n          }\n        }\n      }\n\n      if (updates.length > 0) {\n        // Updates the size/positions of the cell with the resize\n        // observer updates\n        positioner.update(updates)\n        updater(updates)\n      }\n    }) as ResizeObserverCallback)\n\n    const ro = new ResizeObserver(handleEntries)\n    // Overrides the original disconnect to include cancelling handling the entries.\n    // Ideally this would be its own method but that would result in a breaking\n    // change.\n    const disconnect = ro.disconnect.bind(ro)\n    ro.disconnect = () => {\n      disconnect()\n      handleEntries.cancel()\n    }\n\n    return ro\n  }\n)\n","type Color = 0 | 1 | 2\nconst RED = 0\nconst BLACK = 1\nconst NIL = 2\n\nconst DELETE = 0\nconst KEEP = 1\n\ntype ListNode = {\n  index: number\n  high: number\n  next: ListNode | null\n}\n\ninterface TreeNode {\n  max: number\n  low: number\n  high: number\n  // color\n  C: Color\n  // P\n  P: TreeNode\n  // right\n  R: TreeNode\n  // left\n  L: TreeNode\n  list: ListNode\n}\n\ninterface Tree {\n  root: TreeNode\n  size: number\n}\n\nfunction addInterval(treeNode: TreeNode, high: number, index: number): boolean {\n  let node: ListNode | null = treeNode.list\n  let prevNode: ListNode | undefined\n\n  while (node) {\n    if (node.index === index) return false\n    if (high > node.high) break\n    prevNode = node\n    node = node.next\n  }\n\n  if (!prevNode) treeNode.list = {index, high, next: node}\n  if (prevNode) prevNode.next = {index, high, next: prevNode.next}\n\n  return true\n}\n\nfunction removeInterval(treeNode: TreeNode, index: number) {\n  let node: ListNode | null = treeNode.list\n  if (node.index === index) {\n    if (node.next === null) return DELETE\n    treeNode.list = node.next\n    return KEEP\n  }\n\n  let prevNode: ListNode | undefined = node\n  node = node.next\n\n  while (node !== null) {\n    if (node.index === index) {\n      prevNode.next = node.next\n      return KEEP\n    }\n    prevNode = node\n    node = node.next\n  }\n}\n\nconst NULL_NODE: TreeNode = {\n  low: 0,\n  max: 0,\n  high: 0,\n  C: NIL,\n  // @ts-ignore\n  P: undefined,\n  // @ts-ignore\n  R: undefined,\n  // @ts-ignore\n  L: undefined,\n  // @ts-ignore\n  list: undefined,\n}\n\nNULL_NODE.P = NULL_NODE\nNULL_NODE.L = NULL_NODE\nNULL_NODE.R = NULL_NODE\n\nfunction updateMax(node: TreeNode) {\n  const max = node.high\n  if (node.L === NULL_NODE && node.R === NULL_NODE) node.max = max\n  else if (node.L === NULL_NODE) node.max = Math.max(node.R.max, max)\n  else if (node.R === NULL_NODE) node.max = Math.max(node.L.max, max)\n  else node.max = Math.max(Math.max(node.L.max, node.R.max), max)\n}\n\nfunction updateMaxUp(node: TreeNode) {\n  let x = node\n\n  while (x.P !== NULL_NODE) {\n    updateMax(x.P)\n    x = x.P\n  }\n}\n\nfunction rotateLeft(tree: Tree, x: TreeNode) {\n  if (x.R === NULL_NODE) return\n  const y = x.R\n  x.R = y.L\n  if (y.L !== NULL_NODE) y.L.P = x\n  y.P = x.P\n\n  if (x.P === NULL_NODE) tree.root = y\n  else {\n    if (x === x.P.L) x.P.L = y\n    else x.P.R = y\n  }\n\n  y.L = x\n  x.P = y\n\n  updateMax(x)\n  updateMax(y)\n}\n\nfunction rotateRight(tree: Tree, x: TreeNode) {\n  if (x.L === NULL_NODE) return\n  const y = x.L\n  x.L = y.R\n  if (y.R !== NULL_NODE) y.R.P = x\n  y.P = x.P\n\n  if (x.P === NULL_NODE) tree.root = y\n  else {\n    if (x === x.P.R) x.P.R = y\n    else x.P.L = y\n  }\n\n  y.R = x\n  x.P = y\n\n  updateMax(x)\n  updateMax(y)\n}\n\nfunction replaceNode(tree: Tree, x: TreeNode, y: TreeNode) {\n  if (x.P === NULL_NODE) tree.root = y\n  else if (x === x.P.L) x.P.L = y\n  else x.P.R = y\n  y.P = x.P\n}\n\nfunction fixRemove(tree: Tree, x: TreeNode) {\n  let w\n\n  while (x !== NULL_NODE && x.C === BLACK) {\n    if (x === x.P.L) {\n      w = x.P.R\n\n      if (w.C === RED) {\n        w.C = BLACK\n        x.P.C = RED\n        rotateLeft(tree, x.P)\n        w = x.P.R\n      }\n\n      if (w.L.C === BLACK && w.R.C === BLACK) {\n        w.C = RED\n        x = x.P\n      } else {\n        if (w.R.C === BLACK) {\n          w.L.C = BLACK\n          w.C = RED\n          rotateRight(tree, w)\n          w = x.P.R\n        }\n\n        w.C = x.P.C\n        x.P.C = BLACK\n        w.R.C = BLACK\n        rotateLeft(tree, x.P)\n        x = tree.root\n      }\n    } else {\n      w = x.P.L\n\n      if (w.C === RED) {\n        w.C = BLACK\n        x.P.C = RED\n        rotateRight(tree, x.P)\n        w = x.P.L\n      }\n\n      if (w.R.C === BLACK && w.L.C === BLACK) {\n        w.C = RED\n        x = x.P\n      } else {\n        if (w.L.C === BLACK) {\n          w.R.C = BLACK\n          w.C = RED\n          rotateLeft(tree, w)\n          w = x.P.L\n        }\n\n        w.C = x.P.C\n        x.P.C = BLACK\n        w.L.C = BLACK\n        rotateRight(tree, x.P)\n        x = tree.root\n      }\n    }\n  }\n\n  x.C = BLACK\n}\n\nfunction minimumTree(x: TreeNode) {\n  while (x.L !== NULL_NODE) x = x.L\n  return x\n}\n\nfunction fixInsert(tree: Tree, z: TreeNode) {\n  let y: TreeNode\n  while (z.P.C === RED) {\n    if (z.P === z.P.P.L) {\n      y = z.P.P.R\n\n      if (y.C === RED) {\n        z.P.C = BLACK\n        y.C = BLACK\n        z.P.P.C = RED\n        z = z.P.P\n      } else {\n        if (z === z.P.R) {\n          z = z.P\n          rotateLeft(tree, z)\n        }\n\n        z.P.C = BLACK\n        z.P.P.C = RED\n        rotateRight(tree, z.P.P)\n      }\n    } else {\n      y = z.P.P.L\n\n      if (y.C === RED) {\n        z.P.C = BLACK\n        y.C = BLACK\n        z.P.P.C = RED\n        z = z.P.P\n      } else {\n        if (z === z.P.L) {\n          z = z.P\n          rotateRight(tree, z)\n        }\n\n        z.P.C = BLACK\n        z.P.P.C = RED\n        rotateLeft(tree, z.P.P)\n      }\n    }\n  }\n  tree.root.C = BLACK\n}\n\nexport interface IIntervalTree {\n  insert(low: number, high: number, index: number): void\n  remove(index: number): void\n  search(\n    low: number,\n    high: number,\n    callback: (index: number, low: number) => any\n  ): void\n  size: number\n}\n\nexport function createIntervalTree(): IIntervalTree {\n  const tree = {\n    root: NULL_NODE,\n    size: 0,\n  }\n  // we know these indexes are a consistent, safe way to make look ups\n  // for our case so it's a solid O(1) alternative to\n  // the O(log n) searchNode() in typical interval trees\n  const indexMap: Record<number, TreeNode> = {}\n\n  return {\n    insert(low, high, index) {\n      let x: TreeNode = tree.root\n      let y: TreeNode = NULL_NODE\n\n      while (x !== NULL_NODE) {\n        y = x\n        if (low === y.low) break\n        if (low < x.low) x = x.L\n        else x = x.R\n      }\n\n      if (low === y.low && y !== NULL_NODE) {\n        if (!addInterval(y, high, index)) return\n        y.high = Math.max(y.high, high)\n        updateMax(y)\n        updateMaxUp(y)\n        indexMap[index] = y\n        tree.size++\n        return\n      }\n\n      const z: TreeNode = {\n        low,\n        high,\n        max: high,\n        C: RED,\n        P: y,\n        L: NULL_NODE,\n        R: NULL_NODE,\n        list: {index, high, next: null},\n      }\n\n      if (y === NULL_NODE) {\n        tree.root = z\n      } else {\n        if (z.low < y.low) y.L = z\n        else y.R = z\n        updateMaxUp(z)\n      }\n\n      fixInsert(tree, z)\n      indexMap[index] = z\n      tree.size++\n    },\n\n    remove(index) {\n      const z = indexMap[index]\n      if (z === void 0) return\n      delete indexMap[index]\n\n      const intervalResult = removeInterval(z, index)\n      if (intervalResult === void 0) return\n      if (intervalResult === KEEP) {\n        z.high = z.list.high\n        updateMax(z)\n        updateMaxUp(z)\n        tree.size--\n        return\n      }\n\n      let y = z\n      let originalYColor = y.C\n      let x: TreeNode\n\n      if (z.L === NULL_NODE) {\n        x = z.R\n        replaceNode(tree, z, z.R)\n      } else if (z.R === NULL_NODE) {\n        x = z.L\n        replaceNode(tree, z, z.L)\n      } else {\n        y = minimumTree(z.R)\n        originalYColor = y.C\n        x = y.R\n\n        if (y.P === z) {\n          x.P = y\n        } else {\n          replaceNode(tree, y, y.R)\n          y.R = z.R\n          y.R.P = y\n        }\n\n        replaceNode(tree, z, y)\n        y.L = z.L\n        y.L.P = y\n        y.C = z.C\n      }\n\n      updateMax(x)\n      updateMaxUp(x)\n\n      if (originalYColor === BLACK) fixRemove(tree, x)\n      tree.size--\n    },\n\n    search(low, high, callback) {\n      const stack = [tree.root]\n      while (stack.length !== 0) {\n        const node = stack.pop() as TreeNode\n        if (node === NULL_NODE || low > node.max) continue\n        if (node.L !== NULL_NODE) stack.push(node.L)\n        if (node.R !== NULL_NODE) stack.push(node.R)\n        if (node.low <= high && node.high >= low) {\n          let curr: ListNode | null = node.list\n          while (curr !== null) {\n            if (curr.high >= low) callback(curr.index, node.low)\n            curr = curr.next\n          }\n        }\n      }\n    },\n\n    get size() {\n      return tree.size\n    },\n  }\n}\n","import * as React from 'react'\nimport {createIntervalTree} from './interval-tree'\n\n/**\n * This hook creates the grid cell positioner and cache required by `useMasonry()`. This is\n * the meat of the grid's layout algorithm, determining which cells to render at a given scroll\n * position, as well as where to place new items in the grid.\n *\n * @param options Properties that determine the number of columns in the grid, as well\n *  as their widths.\n * @param deps This hook will create a new positioner, clearing all existing cached positions,\n *  whenever the dependencies in this list change.\n */\nexport function usePositioner(\n  {\n    width,\n    columnWidth = 200,\n    columnGutter = 0,\n    columnCount,\n  }: UsePositionerOptions,\n  deps: React.DependencyList = emptyArr\n): Positioner {\n  const initPositioner = (): Positioner => {\n    const [computedColumnWidth, computedColumnCount] = getColumns(\n      width,\n      columnWidth,\n      columnGutter,\n      columnCount\n    )\n    return createPositioner(\n      computedColumnCount,\n      computedColumnWidth,\n      columnGutter\n    )\n  }\n  const positionerRef = React.useRef<Positioner>()\n  if (positionerRef.current === undefined)\n    positionerRef.current = initPositioner()\n\n  const prevDeps = React.useRef(deps)\n  const opts = [width, columnWidth, columnGutter, columnCount]\n  const prevOpts = React.useRef(opts)\n  const optsChanged = !opts.every((item, i) => prevOpts.current[i] === item)\n\n  if (typeof process !== 'undefined' && process.env.NODE_ENV !== 'production') {\n    if (deps.length !== prevDeps.current.length) {\n      throw new Error(\n        'usePositioner(): The length of your dependencies array changed.'\n      )\n    }\n  }\n\n  // Create a new positioner when the dependencies or sizes change\n  // Thanks to https://github.com/khmm12 for pointing this out\n  // https://github.com/jaredLunde/masonic/pull/41\n  if (optsChanged || !deps.every((item, i) => prevDeps.current[i] === item)) {\n    const prevPositioner = positionerRef.current\n    const positioner = initPositioner()\n    prevDeps.current = deps\n    prevOpts.current = opts\n\n    if (optsChanged) {\n      const cacheSize = prevPositioner.size()\n      for (let index = 0; index < cacheSize; index++) {\n        const pos = prevPositioner.get(index)\n        positioner.set(index, pos !== void 0 ? pos.height : 0)\n      }\n    }\n\n    positionerRef.current = positioner\n  }\n\n  return positionerRef.current\n}\n\nexport interface UsePositionerOptions {\n  /**\n   * The width of the container you're rendering the grid within, i.e. the container\n   * element's `element.offsetWidth`\n   */\n  width: number\n  /**\n   * The minimum column width. The `usePositioner()` hook will automatically size the\n   * columns to fill their container based upon the `columnWidth` and `columnGutter` values.\n   * It will never render anything smaller than this width unless its container itself is\n   * smaller than its value. This property is optional if you're using a static `columnCount`.\n   * @default 200\n   */\n  columnWidth?: number\n  /**\n   * This sets the vertical and horizontal space between grid cells in pixels.\n   */\n  columnGutter?: number\n  /**\n   * By default, `usePositioner()` derives the column count from the `columnWidth`, `columnGutter`,\n   * and `width` props. However, in some situations it is nice to be able to override that behavior\n   * (e.g. creating a `List` component).\n   */\n  columnCount?: number\n}\n\n/**\n * Creates a cell positioner for the `useMasonry()` hook. The `usePositioner()` hook uses\n * this utility under the hood.\n *\n * @param columnCount The number of columns in the grid\n * @param columnWidth The width of each column in the grid\n * @param columnGutter The amount of horizontal and vertical space in pixels to render\n *  between each grid item.\n */\nexport const createPositioner = (\n  columnCount: number,\n  columnWidth: number,\n  columnGutter = 0\n): Positioner => {\n  // O(log(n)) lookup of cells to render for a given viewport size\n  // Store tops and bottoms of each cell for fast intersection lookup.\n  const intervalTree = createIntervalTree()\n  // Track the height of each column.\n  // Layout algorithm below always inserts into the shortest column.\n  const columnHeights: number[] = new Array(columnCount)\n  // Used for O(1) item access\n  const items: PositionerItem[] = []\n  // Tracks the item indexes within an individual column\n  const columnItems: number[][] = new Array(columnCount)\n\n  for (let i = 0; i < columnCount; i++) {\n    columnHeights[i] = 0\n    columnItems[i] = []\n  }\n\n  return {\n    columnCount,\n    columnWidth,\n    set: (index, height = 0) => {\n      let column = 0\n\n      // finds the shortest column and uses it\n      for (let i = 1; i < columnHeights.length; i++) {\n        if (columnHeights[i] < columnHeights[column]) column = i\n      }\n\n      const top = columnHeights[column] || 0\n      columnHeights[column] = top + height + columnGutter\n      columnItems[column].push(index)\n      items[index] = {\n        left: column * (columnWidth + columnGutter),\n        top,\n        height,\n        column,\n      }\n      intervalTree.insert(top, top + height, index)\n    },\n    get: (index) => items[index],\n    // This only updates items in the specific columns that have changed, on and after the\n    // specific items that have changed\n    update: (updates) => {\n      const columns: number[] = new Array(columnCount)\n      let i = 0,\n        j = 0\n\n      // determines which columns have items that changed, as well as the minimum index\n      // changed in that column, as all items after that index will have their positions\n      // affected by the change\n      for (; i < updates.length - 1; i++) {\n        const index = updates[i]\n        const item = items[index]\n        item.height = updates[++i]\n        intervalTree.remove(index)\n        intervalTree.insert(item.top, item.top + item.height, index)\n        columns[item.column] =\n          columns[item.column] === void 0\n            ? index\n            : Math.min(index, columns[item.column])\n      }\n\n      for (i = 0; i < columns.length; i++) {\n        // bails out if the column didn't change\n        if (columns[i] === void 0) continue\n        const itemsInColumn = columnItems[i]\n        // the index order is sorted with certainty so binary search is a great solution\n        // here as opposed to Array.indexOf()\n        const startIndex = binarySearch(itemsInColumn, columns[i])\n        const index = columnItems[i][startIndex]\n        const startItem = items[index]\n        columnHeights[i] = startItem.top + startItem.height + columnGutter\n\n        for (j = startIndex + 1; j < itemsInColumn.length; j++) {\n          const index = itemsInColumn[j]\n          const item = items[index]\n          item.top = columnHeights[i]\n          columnHeights[i] = item.top + item.height + columnGutter\n          intervalTree.remove(index)\n          intervalTree.insert(item.top, item.top + item.height, index)\n        }\n      }\n    },\n    // Render all cells visible within the viewport range defined.\n    range: (lo, hi, renderCallback) =>\n      intervalTree.search(lo, hi, (index, top) =>\n        renderCallback(index, items[index].left, top)\n      ),\n    estimateHeight: (itemCount, defaultItemHeight): number => {\n      const tallestColumn = Math.max(0, Math.max.apply(null, columnHeights))\n\n      return itemCount === intervalTree.size\n        ? tallestColumn\n        : tallestColumn +\n            Math.ceil((itemCount - intervalTree.size) / columnCount) *\n              defaultItemHeight\n    },\n    shortestColumn: () => {\n      if (columnHeights.length > 1) return Math.min.apply(null, columnHeights)\n      return columnHeights[0] || 0\n    },\n    size(): number {\n      return intervalTree.size\n    },\n  }\n}\n\nexport interface Positioner {\n  /**\n   * The number of columns in the grid\n   */\n  columnCount: number\n  /**\n   * The width of each column in the grid\n   */\n  columnWidth: number\n  /**\n   * Sets the position for the cell at `index` based upon the cell's height\n   */\n  set: (index: number, height: number) => void\n  /**\n   * Gets the `PositionerItem` for the cell at `index`\n   */\n  get: (index: number) => PositionerItem | undefined\n  /**\n   * Updates cells based on their indexes and heights\n   * positioner.update([index, height, index, height, index, height...])\n   */\n  update: (updates: number[]) => void\n  /**\n   * Searches the interval tree for grid cells with a `top` value in\n   * betwen `lo` and `hi` and invokes the callback for each item that\n   * is discovered\n   */\n  range: (\n    lo: number,\n    hi: number,\n    renderCallback: (index: number, left: number, top: number) => void\n  ) => void\n  /**\n   * Returns the number of grid cells in the cache\n   */\n\n  size: () => number\n  /**\n   * Estimates the total height of the grid\n   */\n\n  estimateHeight: (itemCount: number, defaultItemHeight: number) => number\n  /**\n   * Returns the height of the shortest column in the grid\n   */\n\n  shortestColumn: () => number\n}\n\nexport interface PositionerItem {\n  /**\n   * This is how far from the top edge of the grid container in pixels the\n   * item is placed\n   */\n  top: number\n  /**\n   * This is how far from the left edge of the grid container in pixels the\n   * item is placed\n   */\n  left: number\n  /**\n   * This is the height of the grid cell\n   */\n  height: number\n  /**\n   * This is the column number containing the grid cell\n   */\n  column: number\n}\n\n/* istanbul ignore next */\nconst binarySearch = (a: number[], y: number): number => {\n  let l = 0\n  let h = a.length - 1\n\n  while (l <= h) {\n    const m = (l + h) >>> 1\n    const x = a[m]\n    if (x === y) return m\n    else if (x <= y) l = m + 1\n    else h = m - 1\n  }\n\n  return -1\n}\n\nconst getColumns = (\n  width = 0,\n  minimumWidth = 0,\n  gutter = 8,\n  columnCount?: number\n): [number, number] => {\n  columnCount = columnCount || Math.floor(width / (minimumWidth + gutter)) || 1\n  const columnWidth = Math.floor(\n    (width - gutter * (columnCount - 1)) / columnCount\n  )\n  return [columnWidth, columnCount]\n}\n\nconst emptyArr: [] = []\n","import * as React from 'react'\nimport useLatest from '@react-hook/latest'\nimport useEvent from '@react-hook/event'\nimport {useThrottleCallback} from '@react-hook/throttle'\nimport type {Positioner, PositionerItem} from './use-positioner'\n\n/**\n * A hook that creates a callback for scrolling to a specific index in\n * the \"items\" array.\n *\n * @param positioner A positioner created by the `usePositioner()` hook\n * @param options Configuration options\n */\nexport function useScrollToIndex(\n  positioner: Positioner,\n  options: UseScrollToIndexOptions\n) {\n  const {\n    align = 'top',\n    element = typeof window !== 'undefined' && window,\n    offset = 0,\n    height = typeof window !== 'undefined' ? window.innerHeight : 0,\n  } = options\n  const latestOptions = useLatest({\n    positioner,\n    element,\n    align,\n    offset,\n    height,\n  } as const)\n  const getTarget = React.useRef(() => {\n    const latestElement = latestOptions.current.element\n    return latestElement && 'current' in latestElement\n      ? latestElement.current\n      : latestElement\n  }).current\n  const [state, dispatch] = React.useReducer(\n    (\n      state: {\n        position: PositionerItem | undefined\n        index: number | undefined\n        prevTop: number | undefined\n      },\n      action:\n        | {type: 'scrollToIndex'; value: number | undefined}\n        | {type: 'setPosition'; value: PositionerItem | undefined}\n        | {type: 'setPrevTop'; value: number | undefined}\n        | {type: 'reset'}\n    ) => {\n      const nextState = {\n        position: state.position,\n        index: state.index,\n        prevTop: state.prevTop,\n      }\n\n      /* istanbul ignore next */\n      if (action.type === 'scrollToIndex') {\n        return {\n          position: latestOptions.current.positioner.get(action.value ?? -1),\n          index: action.value,\n          prevTop: void 0,\n        }\n      } else if (action.type === 'setPosition') {\n        nextState.position = action.value\n      } else if (action.type === 'setPrevTop') {\n        nextState.prevTop = action.value\n      } else if (action.type === 'reset') {\n        return defaultState\n      }\n\n      return nextState\n    },\n    defaultState\n  )\n  const throttledDispatch = useThrottleCallback(dispatch, 15)\n\n  // If we find the position along the way we can immediately take off\n  // to the correct spot.\n  useEvent(getTarget() as Window, 'scroll', () => {\n    if (!state.position && state.index) {\n      const position = latestOptions.current.positioner.get(state.index)\n\n      if (position) {\n        dispatch({type: 'setPosition', value: position})\n      }\n    }\n  })\n\n  // If the top changes out from under us in the case of dynamic cells, we\n  // want to keep following it.\n  const currentTop =\n    state.index !== void 0 &&\n    latestOptions.current.positioner.get(state.index)?.top\n\n  React.useEffect(() => {\n    const target = getTarget()\n    if (!target) return\n    const {height, align, offset, positioner} = latestOptions.current\n\n    if (state.position) {\n      let scrollTop = state.position.top\n\n      if (align === 'bottom') {\n        scrollTop = scrollTop - height + state.position.height\n      } else if (align === 'center') {\n        scrollTop -= (height - state.position.height) / 2\n      }\n\n      target.scrollTo(0, Math.max(0, (scrollTop += offset)))\n      // Resets state after 400ms, an arbitrary time I determined to be\n      // still visually pleasing if there is a slow network reply in dynamic\n      // cells\n      let didUnsubscribe = false\n      const timeout = setTimeout(\n        () => !didUnsubscribe && dispatch({type: 'reset'}),\n        400\n      )\n      return () => {\n        didUnsubscribe = true\n        clearTimeout(timeout)\n      }\n    } else if (state.index !== void 0) {\n      // Estimates the top based upon the average height of current cells\n      let estimatedTop =\n        (positioner.shortestColumn() / positioner.size()) * state.index\n      if (state.prevTop)\n        estimatedTop = Math.max(estimatedTop, state.prevTop + height)\n      target.scrollTo(0, estimatedTop)\n      throttledDispatch({type: 'setPrevTop', value: estimatedTop})\n    }\n  }, [currentTop, state, latestOptions, getTarget, throttledDispatch])\n\n  return React.useRef((index: number) => {\n    dispatch({type: 'scrollToIndex', value: index})\n  }).current\n}\n\nconst defaultState = {\n  index: void 0,\n  position: void 0,\n  prevTop: void 0,\n} as const\n\nexport type UseScrollToIndexOptions = {\n  /**\n   * The window element or a React ref for the window element. That is,\n   * this is the grid container.\n   * @default window\n   */\n  element?: Window | HTMLElement | React.RefObject<HTMLElement> | null\n  /**\n   * Sets the vertical alignment of the cell within the grid container.\n   * @default \"top\"\n   */\n  align?: 'center' | 'top' | 'bottom'\n  /**\n   * The height of the grid.\n   * @default window.innerHeight\n   */\n  height?: number\n  /**\n   * The vertical space in pixels between the top of the grid container and the top\n   * of the window.\n   * @default 0\n   */\n  offset?: number\n}\n","import * as React from 'react'\nimport {useWindowSize} from '@react-hook/window-size'\nimport {MasonryScroller} from './masonry-scroller'\nimport type {MasonryScrollerProps} from './masonry-scroller'\nimport {useContainerPosition} from './use-container-position'\nimport {useResizeObserver} from './use-resize-observer'\nimport {usePositioner} from './use-positioner'\nimport type {UsePositionerOptions} from './use-positioner'\nimport {useScrollToIndex} from './use-scroll-to-index'\nimport type {UseScrollToIndexOptions} from './use-scroll-to-index'\n\n/**\n * A \"batteries included\" masonry grid which includes all of the implementation details below. This component is the\n * easiest way to get off and running in your app, before switching to more advanced implementations, if necessary.\n * It will change its column count to fit its container's width and will decide how many rows to render based upon\n * the height of the browser `window`.\n */\nexport function Masonry<Item>(props: MasonryProps<Item>) {\n  const containerRef = React.useRef<null | HTMLElement>(null)\n  const windowSize = useWindowSize({\n    initialWidth: props.ssrWidth,\n    initialHeight: props.ssrHeight,\n  })\n  const containerPos = useContainerPosition(containerRef, windowSize)\n  const nextProps = Object.assign(\n    {\n      offset: containerPos.offset,\n      width: containerPos.width || windowSize[0],\n      height: windowSize[1],\n      containerRef,\n    },\n    props\n  ) as any\n  nextProps.positioner = usePositioner(nextProps)\n  nextProps.resizeObserver = useResizeObserver(nextProps.positioner)\n  const scrollToIndex = useScrollToIndex(nextProps.positioner, {\n    height: nextProps.height,\n    offset: containerPos.offset,\n    align:\n      typeof props.scrollToIndex === 'object'\n        ? props.scrollToIndex.align\n        : void 0,\n  })\n  const index =\n    props.scrollToIndex &&\n    (typeof props.scrollToIndex === 'number'\n      ? props.scrollToIndex\n      : props.scrollToIndex.index)\n\n  React.useEffect(() => {\n    if (index !== void 0) scrollToIndex(index)\n  }, [index, scrollToIndex])\n\n  return React.createElement(MasonryScroller, nextProps)\n}\n\nexport interface MasonryProps<Item>\n  extends Omit<\n      MasonryScrollerProps<Item>,\n      'offset' | 'width' | 'height' | 'containerRef' | 'positioner'\n    >,\n    Pick<UsePositionerOptions, 'columnWidth' | 'columnGutter' | 'columnCount'> {\n  /**\n   * Scrolls to a given index within the grid. The grid will re-scroll\n   * any time the index changes.\n   */\n  scrollToIndex?:\n    | number\n    | {\n        index: number\n        align: UseScrollToIndexOptions['align']\n      }\n  /**\n   * This is the width that will be used for the browser `window` when rendering this component in SSR.\n   * This prop isn't relevant for client-side only apps.\n   */\n  ssrWidth?: number\n  /**\n   * This is the height that will be used for the browser `window` when rendering this component in SSR.\n   * This prop isn't relevant for client-side only apps.\n   */\n  ssrHeight?: number\n  /**\n   * This determines how often (in frames per second) to update the scroll position of the\n   * browser `window` in state, and as a result the rate the masonry grid recalculates its visible cells.\n   * The default value of `12` has been very reasonable in my own testing, but if you have particularly\n   * heavy `render` components it may be prudent to reduce this number.\n   * @default 12\n   */\n  scrollFps?: number\n}\n\nif (typeof process !== 'undefined' && process.env.NODE_ENV !== 'production') {\n  Masonry.displayName = 'Masonry'\n}\n","import * as React from 'react'\nimport {Masonry} from './masonry'\nimport type {MasonryProps} from './masonry'\n\n/**\n * This is just a single-column `<Masonry>` component with `rowGutter` prop instead of\n * a `columnGutter` prop.\n */\nexport function List<Item>(props: ListProps<Item>) {\n  return (\n    <Masonry<Item>\n      role='list'\n      columnGutter={props.rowGutter}\n      columnCount={1}\n      columnWidth={1}\n      {...props}\n    />\n  )\n}\n\nexport interface ListProps<Item>\n  extends Omit<\n    MasonryProps<Item>,\n    'columGutter' | 'columnCount' | 'columnWidth'\n  > {\n  /**\n   * The amount of vertical space in pixels to add between the list cells.\n   * @default 0\n   */\n  rowGutter?: number\n}\n\nif (typeof process !== 'undefined' && process.env.NODE_ENV !== 'production') {\n  List.displayName = 'List'\n}\n","import * as React from 'react'\nimport useLatest from '@react-hook/latest'\n\n/**\n * A utility hook for seamlessly adding infinite scroll behavior to the `useMasonry()` hook. This\n * hook invokes a callback each time the last rendered index surpasses the total number of items\n * in your items array or the number defined in the `totalItems` option.\n *\n * @param loadMoreItems This callback is invoked when more rows must be loaded. It will be used to\n *  determine when to refresh the list with the newly-loaded data. This callback may be called multiple\n *  times in reaction to a single scroll event, so it's important to memoize its arguments. If you're\n *  creating this callback inside of a functional component, make sure you wrap it in `React.useCallback()`,\n *  as well.\n * @param options\n */\nexport function useInfiniteLoader<Item, T extends LoadMoreItemsCallback<Item>>(\n  loadMoreItems: T,\n  options: UseInfiniteLoaderOptions<Item> = emptyObj\n): LoadMoreItemsCallback<Item> {\n  const {\n    isItemLoaded,\n    minimumBatchSize = 16,\n    threshold = 16,\n    totalItems = 9e9,\n  } = options\n  const storedLoadMoreItems = useLatest(loadMoreItems)\n  const storedIsItemLoaded = useLatest(isItemLoaded)\n\n  return React.useCallback(\n    (startIndex, stopIndex, items) => {\n      const unloadedRanges = scanForUnloadedRanges(\n        storedIsItemLoaded.current,\n        minimumBatchSize,\n        items,\n        totalItems,\n        Math.max(0, startIndex - threshold),\n        Math.min(totalItems - 1, (stopIndex || 0) + threshold)\n      )\n      // The user is responsible for memoizing their loadMoreItems() function\n      // because we don't want to make assumptions about how they want to deal\n      // with `items`\n      for (let i = 0; i < unloadedRanges.length - 1; ++i)\n        storedLoadMoreItems.current(\n          unloadedRanges[i],\n          unloadedRanges[++i],\n          items\n        )\n    },\n    [\n      totalItems,\n      minimumBatchSize,\n      threshold,\n      storedLoadMoreItems,\n      storedIsItemLoaded,\n    ]\n  )\n}\n\n/**\n * Returns all of the ranges within a larger range that contain unloaded rows.\n */\nfunction scanForUnloadedRanges<Item>(\n  isItemLoaded: UseInfiniteLoaderOptions<\n    Item\n  >['isItemLoaded'] = defaultIsItemLoaded,\n  minimumBatchSize: UseInfiniteLoaderOptions<Item>['minimumBatchSize'] = 16,\n  items: any[],\n  totalItems: UseInfiniteLoaderOptions<Item>['totalItems'] = 9e9,\n  startIndex: number,\n  stopIndex: number\n): number[] {\n  const unloadedRanges: number[] = []\n  let rangeStartIndex: number | undefined,\n    rangeStopIndex: number | undefined,\n    index = startIndex\n\n  /* istanbul ignore next */\n  for (; index <= stopIndex; index++) {\n    if (!isItemLoaded(index, items)) {\n      rangeStopIndex = index\n      if (rangeStartIndex === void 0) rangeStartIndex = index\n    } else if (rangeStartIndex !== void 0 && rangeStopIndex !== void 0) {\n      unloadedRanges.push(rangeStartIndex, rangeStopIndex)\n      rangeStartIndex = rangeStopIndex = void 0\n    }\n  }\n\n  // If :rangeStopIndex is not null it means we haven't run out of unloaded rows.\n  // Scan forward to try filling our :minimumBatchSize.\n  if (rangeStartIndex !== void 0 && rangeStopIndex !== void 0) {\n    const potentialStopIndex = Math.min(\n      Math.max(rangeStopIndex, rangeStartIndex + minimumBatchSize - 1),\n      totalItems - 1\n    )\n\n    /* istanbul ignore next */\n    for (index = rangeStopIndex + 1; index <= potentialStopIndex; index++) {\n      if (!isItemLoaded(index, items)) {\n        rangeStopIndex = index\n      } else {\n        break\n      }\n    }\n\n    unloadedRanges.push(rangeStartIndex, rangeStopIndex)\n  }\n\n  // Check to see if our first range ended prematurely.\n  // In this case we should scan backwards to try filling our :minimumBatchSize.\n  /* istanbul ignore next */\n  if (unloadedRanges.length) {\n    let firstUnloadedStart = unloadedRanges[0]\n    const firstUnloadedStop = unloadedRanges[1]\n\n    while (\n      firstUnloadedStop - firstUnloadedStart + 1 < minimumBatchSize &&\n      firstUnloadedStart > 0\n    ) {\n      const index = firstUnloadedStart - 1\n\n      if (!isItemLoaded(index, items)) {\n        unloadedRanges[0] = firstUnloadedStart = index\n      } else {\n        break\n      }\n    }\n  }\n\n  return unloadedRanges\n}\n\nconst defaultIsItemLoaded = <Item>(index: number, items: Item[]): boolean =>\n  items[index] !== void 0\n\nexport interface UseInfiniteLoaderOptions<Item> {\n  /**\n   *  A callback responsible for determining the loaded state of each item. Should return `true`\n   * if the item has already been loaded and `false` if not.\n   * @default (index: number, items: any[]) => boolean\n   */\n  isItemLoaded?: (index: number, items: Item[]) => boolean\n  /**\n   * The minimum number of new items to be loaded at a time.  This property can be used to\n   * batch requests and reduce HTTP requests.\n   * @default 16\n   */\n  minimumBatchSize?: number\n  /**\n   * The threshold at which to pre-fetch data. A threshold X means that new data should start\n   * loading when a user scrolls within X cells of the end of your `items` array.\n   * @default 16\n   */\n  threshold?: number\n  /**\n   * The total number of items you'll need to eventually load (if known). This can\n   * be arbitrarily high if not known.\n   * @default 9e9\n   */\n  totalItems?: number\n}\n\nexport type LoadMoreItemsCallback<Item> = (\n  startIndex: number,\n  stopIndex: number,\n  items: Item[]\n) => any\n\nconst emptyObj = {}\n"],"names":["useScroller","offset","fps","scrollTop","useScrollPosition","isScrolling","setIsScrolling","React","didMount","current","to","requestTimeout","clearRequestTimeout","Math","max","elementsCache","WeakMap","useForceUpdate","setState","emptyObj","useMasonry","positioner","resizeObserver","items","as","ContainerComponent","id","className","style","role","tabIndex","containerRef","itemAs","ItemComponent","itemStyle","itemHeightEstimate","itemKey","defaultGetItemKey","overscanBy","height","render","RenderComponent","onRender","startIndex","stopIndex","forceUpdate","setItemRef","getRefSetter","itemCount","length","columnWidth","columnCount","range","estimateHeight","size","shortestColumn","measuredCount","shortestColumnSize","children","itemRole","storedOnRender","useLatest","rangeEnd","needsFreshBatch","index","left","top","data","key","phaseTwoStyle","width","writingMode","position","process","throwWithoutData","push","Object","assign","createRenderElement","min","batchSize","ceil","phaseOneStyle","getCachedSize","didEverMount","containerStyle","getContainerStyle","assignUserStyle","Error","trieMemoize","OneKeyMap","memoizeOne","maxWidth","maxHeight","willChange","pointerEvents","cmp2","args","pargs","userStyle","_","i","zIndex","visibility","el","observe","set","get","offsetHeight","MasonryScroller","props","scrollFps","displayName","useContainerPosition","elementRef","deps","emptyArr","containerPosition","setContainerPosition","useLayoutEffect","offsetTop","offsetParent","offsetWidth","useResizeObserver","createResizeObserver","disconnect","updater","handleEntries","rafSchd","entries","updates","entry","target","update","ro","ResizeObserver","bind","cancel","RED","BLACK","NIL","DELETE","KEEP","addInterval","treeNode","high","node","list","prevNode","next","removeInterval","NULL_NODE","low","C","P","undefined","R","L","updateMax","updateMaxUp","x","rotateLeft","tree","y","root","rotateRight","replaceNode","fixRemove","w","minimumTree","fixInsert","z","createIntervalTree","indexMap","insert","remove","intervalResult","originalYColor","search","callback","stack","pop","curr","usePositioner","columnGutter","initPositioner","computedColumnWidth","computedColumnCount","getColumns","createPositioner","positionerRef","prevDeps","opts","prevOpts","optsChanged","every","item","prevPositioner","cacheSize","pos","intervalTree","columnHeights","Array","columnItems","column","columns","j","itemsInColumn","binarySearch","startItem","lo","hi","renderCallback","defaultItemHeight","tallestColumn","apply","a","l","h","m","minimumWidth","gutter","floor","useScrollToIndex","options","align","element","window","innerHeight","latestOptions","getTarget","latestElement","state","dispatch","action","nextState","prevTop","type","value","defaultState","throttledDispatch","useThrottleCallback","useEvent","currentTop","scrollTo","didUnsubscribe","timeout","setTimeout","clearTimeout","estimatedTop","Masonry","windowSize","useWindowSize","initialWidth","ssrWidth","initialHeight","ssrHeight","containerPos","nextProps","scrollToIndex","__reactCreateElement__","List","rowGutter","useInfiniteLoader","loadMoreItems","isItemLoaded","minimumBatchSize","threshold","totalItems","storedLoadMoreItems","storedIsItemLoaded","unloadedRanges","scanForUnloadedRanges","defaultIsItemLoaded","rangeStartIndex","rangeStopIndex","potentialStopIndex","firstUnloadedStart","firstUnloadedStop"],"mappings":"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"}